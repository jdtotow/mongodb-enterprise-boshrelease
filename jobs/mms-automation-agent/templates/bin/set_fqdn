#!/bin/bash

set +e

# Set fqdn as service_id+index or bosh dns address
export fqdn="<%= p('mongodb.use_consul') ? "#{p("mms-automation-agent.service_id")}-#{spec.index}.service.consul" : spec.address %>"

sed -i "s/^\(127.0.0.1\)\W*\(localhost\)/\1 ${fqdn} \2/" /etc/hosts

# Check if fqdn matches what we want
if [ "$(hostname -f)" = "${fqdn}" ]; then
  echo "hostname matches: ${fqdn}"
  exit 0
else
  echo "hostname mismatch, expected ${fqdn}"
  echo "check /etc/hosts"
  exit 1
fi

set -e
